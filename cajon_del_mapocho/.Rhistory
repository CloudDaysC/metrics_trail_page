library(tidyverse)
ggplot(ruta_strm, aes(distance, ele)) +
geom_line() +
geom_vline(xintercept = PCS) +
ylab("Elevación (msnm)") +
xlab("Distancia") +
theme_minimal() +
geom_vline(aes(xintercept = PCS))
knitr::opts_chunk$set(echo = TRUE)
library(GPStream)
library(sp)
library(sp)
library(leaflet)
library(sp)
library(leaflet)
library(tidyverse)
ruta_strm <-
read_stream_file("cajon_del_mapocho.gpx") %>%
rename_stream() %>%
differential_stream()
ruta_strm <-
read_stream_file("cajon_del_mapocho.gpx") %>%
rename_stream() %>%
differential_stream()
ruta_sp <- SpatialPointsDataFrame(data=ruta_strm,
coords = ruta_strm[,c("lon","lat")],
proj4string=CRS("+proj=longlat +datum=WGS84"))
PCS <- c(9.65, 22.05, 33.35, 42.05, 45.7, 50.82, 63.5, 81.55, 87.7)
tramo1 <- ruta_strm %>% filter(distance <= PCS[1])
tramo2 <- ruta_strm %>% filter(distance > PCS[1] & distance <= PCS[2])
tramo3 <- ruta_strm %>% filter(distance > PCS[2] & distance <= PCS[3])
tramo4 <- ruta_strm %>% filter(distance > PCS[3] & distance <= PCS[4])
tramo5 <- ruta_strm %>% filter(distance > PCS[4] & distance <= PCS[5])
tramo6 <- ruta_strm %>% filter(distance > PCS[5] & distance <= PCS[6])
tramo7 <- ruta_strm %>% filter(distance > PCS[6] & distance <= PCS[7])
tramo8 <- ruta_strm %>% filter(distance > PCS[7] & distance <= PCS[8])
tramo9 <- ruta_strm %>% filter(distance > PCS[8] & distance <= PCS[9])
tabla <- data.frame( "Tramo" = c("Tramo 1","Tramo 2","Tramo 3","Tramo 4","Tramo 5","Tramo 6","Tramo 7","Tramo 8","Tramo 9","Total"),
"Distancia" = c(sum(tramo1$delta_distance),
sum(tramo2$delta_distance),
sum(tramo3$delta_distance),
sum(tramo4$delta_distance),
sum(tramo5$delta_distance),
sum(tramo6$delta_distance),
sum(tramo7$delta_distance),
sum(tramo8$delta_distance),
sum(tramo9$delta_distance),
sum(ruta_strm$delta_distance)),
"ElevGain" =  c(sum(tramo1$dplus),
sum(tramo2$dplus),
sum(tramo3$dplus),
sum(tramo4$dplus),
sum(tramo5$dplus),
sum(tramo6$dplus),
sum(tramo7$dplus),
sum(tramo8$dplus),
sum(tramo9$dplus),
sum(ruta_strm$dplus)))
View(ruta_strm)
hitos <- data.frame(rbind(c(tramo1[1,c("lon","lat","ele")], "Puente Ñilhue"),
c(tramo2[1,c("lon","lat","ele")], "Llanos de Javier"),
c(tramo3[1,c("lon","lat","ele")], "Corral quemado"),
c(tramo4[1,c("lon","lat","ele")], "La Parva"),
c(tramo5[1,c("lon","lat","ele")], "Cancha de carreras"),
c(tramo6[1,c("lon","lat","ele")], "Federacion"),
c(tramo7[1,c("lon","lat","ele")], "Piedra numerada"),
c(tramo8[1,c("lon","lat","ele")], "Refugio del Cepo"),
c(tramo9[1,c("lon","lat","ele")], "La Ermita")))
hitos$lat <- as.numeric(hitos$lat)
hitos$lon <- as.numeric(hitos$lon)
hitossp <- SpatialPointsDataFrame(data=hitos, coords = hitos[,1:2], proj4string=CRS("+proj=longlat +datum=WGS84"))
tramo1sp <- tramo1 %>% select(lon,lat) %>%
SpatialPointsDataFrame( data = ., coords = .,proj4string=CRS("+proj=longlat +datum=WGS84"))
tramo2sp <- tramo2 %>% select(lon,lat) %>%
SpatialPointsDataFrame( data = ., coords = .,proj4string=CRS("+proj=longlat +datum=WGS84"))
tramo3sp <- tramo3 %>% select(lon,lat) %>%
SpatialPointsDataFrame( data = ., coords = .,proj4string=CRS("+proj=longlat +datum=WGS84"))
tramo4sp <- tramo4 %>% select(lon,lat) %>%
SpatialPointsDataFrame( data = ., coords = .,proj4string=CRS("+proj=longlat +datum=WGS84"))
tramo5sp <- tramo5 %>% select(lon,lat) %>%
SpatialPointsDataFrame( data = ., coords = .,proj4string=CRS("+proj=longlat +datum=WGS84"))
tramo6sp <- tramo6 %>% select(lon,lat) %>%
SpatialPointsDataFrame( data = ., coords = .,proj4string=CRS("+proj=longlat +datum=WGS84"))
tramo7sp <- tramo7 %>% select(lon,lat) %>%
SpatialPointsDataFrame( data = ., coords = .,proj4string=CRS("+proj=longlat +datum=WGS84"))
tramo8sp <- tramo8 %>% select(lon,lat) %>%
SpatialPointsDataFrame( data = ., coords = .,proj4string=CRS("+proj=longlat +datum=WGS84"))
tramo9sp <- tramo9 %>% select(lon,lat) %>%
SpatialPointsDataFrame( data = ., coords = .,proj4string=CRS("+proj=longlat +datum=WGS84"))
leaflet(width = '100%') %>%
addTiles() %>%  # Add default OpenStreetMap map tiles
addProviderTiles(providers$OpenTopoMap) %>% ## uso mapa topografico
addCircleMarkers(data = tramo1sp, radius = 1, col = topo.colors(9)[9], group="Tramo 1") %>%
addCircleMarkers(data = tramo2sp, radius = 1, col = topo.colors(9)[2], group="Tramo 2") %>%
addCircleMarkers(data = tramo3sp, radius = 1, col = topo.colors(9)[7], group="Tramo 3") %>%
addCircleMarkers(data = tramo4sp, radius = 1, col = topo.colors(9)[4], group="Tramo 4") %>%
addCircleMarkers(data = tramo5sp, radius = 1, col = topo.colors(9)[6], group="Tramo 5") %>%
addCircleMarkers(data = tramo6sp, radius = 1, col = topo.colors(9)[5], group="Tramo 6") %>%
addCircleMarkers(data = tramo7sp, radius = 1, col = topo.colors(9)[3], group="Tramo 7") %>%
addCircleMarkers(data = tramo8sp, radius = 1, col = topo.colors(9)[8], group="Tramo 8") %>%
addCircleMarkers(data = tramo9sp, radius = 1, col = topo.colors(9)[1], group="Tramo 9") %>%
addCircleMarkers(data = hitossp, radius = 5, col = "red", popup = hitossp$V4) %>%
addLayersControl(
overlayGroups =c("Tramo 1", "Tramo 2", "Tramo 3", "Tramo 4", "Tramo 5", "Tramo 6", "Tramo 7", "Tramo 8", "Tramo 9"),
options = layersControlOptions(collapsed=TRUE)
)
ggplot(ruta_strm, aes(distance, ele)) +
geom_line() +
geom_vline(xintercept = PCS) +
ylab("Elevación (msnm)") +
xlab("Distancia") +
theme_minimal() +
geom_vline(aes(xintercept = PCS))
PCS
ggplot(ruta_strm, aes(distance, ele)) +
geom_line() +
geom_vline(xintercept = PCS) +
ylab("Elevación (msnm)") +
xlab("Distancia") +
theme_minimal() +
geom_vline(data = PCS, aes(xintercept = PCS))
ggplot(ruta_strm, aes(distance, ele)) +
geom_line() +
geom_vline(xintercept = PCS) +
ylab("Elevación (msnm)") +
xlab("Distancia") +
theme_minimal() +
geom_vline(data = PCS, aes(xintercept = .))
ggplot(ruta_strm, aes(distance, ele)) +
geom_line() +
geom_vline(xintercept = PCS) +
ylab("Elevación (msnm)") +
xlab("Distancia") +
theme_minimal() +
geom_vline(data = PCS)
PCS <- data.frame(PCS)
View(PCS)
ggplot(ruta_strm, aes(distance, ele)) +
geom_line() +
geom_vline(xintercept = PCS) +
ylab("Elevación (msnm)") +
xlab("Distancia") +
theme_minimal() +
geom_vline(data = PCS, aes(xintercept = PCS))
ggplot(ruta_strm, aes(distance, ele)) +
geom_line() +
geom_vline(xintercept = PCS) +
ylab("Elevación (msnm)") +
xlab("Distancia") +
theme_minimal()
ggplot(ruta_strm, aes(distance, ele)) +
geom_line() +
geom_vline(data = PCS, xintercept = PCS) +
ylab("Elevación (msnm)") +
xlab("Distancia") +
theme_minimal()
ggplot(ruta_strm, aes(distance, ele)) +
geom_line() +
geom_vline( xintercept = PCS) +
ylab("Elevación (msnm)") +
xlab("Distancia") +
theme_minimal()
ggplot(ruta_strm, aes(distance, ele)) +
geom_line()
PCS <- c(9.65, 22.05, 33.35, 42.05, 45.7, 50.82, 63.5, 81.55, 87.7)
ggplot(ruta_strm, aes(distance, ele)) +
geom_line() +
geom_vline( xintercept = PCS) +
ylab("Elevación (msnm)") +
xlab("Distancia") +
theme_minimal()
print(tabla)
library(RColorBrewer)
brewer.pal(n = 8, name = "Dark2")
brewer.pal(n = 9, name = "Dark2")
brewer.pal(n = 9, name = "Paired")
leaflet(width = '100%') %>%
addTiles() %>%  # Add default OpenStreetMap map tiles
addProviderTiles(providers$OpenTopoMap) %>% ## uso mapa topografico
addCircleMarkers(data = tramo1sp, radius = 1, col = brewer.pal(n = 9, name = "Paired")[1], group="Tramo 1") %>%
addCircleMarkers(data = tramo2sp, radius = 1, col = brewer.pal(n = 9, name = "Paired")[2], group="Tramo 2") %>%
addCircleMarkers(data = tramo3sp, radius = 1, col = brewer.pal(n = 9, name = "Paired")[3], group="Tramo 3") %>%
addCircleMarkers(data = tramo4sp, radius = 1, col = brewer.pal(n = 9, name = "Paired")[4], group="Tramo 4") %>%
addCircleMarkers(data = tramo5sp, radius = 1, col = brewer.pal(n = 9, name = "Paired")[5], group="Tramo 5") %>%
addCircleMarkers(data = tramo6sp, radius = 1, col = brewer.pal(n = 9, name = "Paired")[6], group="Tramo 6") %>%
addCircleMarkers(data = tramo7sp, radius = 1, col = brewer.pal(n = 9, name = "Paired")[7], group="Tramo 7") %>%
addCircleMarkers(data = tramo8sp, radius = 1, col = brewer.pal(n = 9, name = "Paired")[8], group="Tramo 8") %>%
addCircleMarkers(data = tramo9sp, radius = 1, col = brewer.pal(n = 9, name = "Paired")[9], group="Tramo 9") %>%
addCircleMarkers(data = hitossp, radius = 5, col = "red", popup = hitossp$V4) %>%
addLayersControl(
overlayGroups =c("Tramo 1", "Tramo 2", "Tramo 3", "Tramo 4", "Tramo 5", "Tramo 6", "Tramo 7", "Tramo 8", "Tramo 9"),
options = layersControlOptions(collapsed=TRUE)
)
ylab("Elevación (msnm)") +
xlab("Distancia") +
theme_minimal()
ggplot(ruta_strm, aes(distance, ele)) +
geom_line() +
geom_vline( xintercept = PCS) +
geom_rect(aes(xmin=PCS[-9], xmax = PCS[-1])) +
ylab("Elevación (msnm)") +
xlab("Distancia") +
theme_minimal()
ggplot(ruta_strm, aes(distance, ele)) +
geom_line() +
geom_vline( xintercept = PCS) +
geom_rect(data = PCS[-1], aes(xmin=PCS[-9], xmax = PCS[-1])) +
ylab("Elevación (msnm)") +
xlab("Distancia") +
theme_minimal()
ggplot(ruta_strm, aes(distance, ele)) +
geom_line() +
geom_vline( xintercept = PCS) +
geom_rect(aes(xmin=c(0,PCS[-9]), xmax = PCS)) +
ylab("Elevación (msnm)") +
xlab("Distancia") +
theme_minimal()
ggplot() +
geom_rect(aes(xmin=c(0,PCS[-9]), xmax = PCS))
ggplot(ruta_strm, aes(distance, ele)) +
geom_line() +
geom_vline( xintercept = PCS) +
geom_rect(aes(xmin=c(0,PCS[-9]), xmax = PCS, ymin = -Inf, ymax = Inf)) +
ylab("Elevación (msnm)") +
xlab("Distancia") +
theme_minimal()
ggplot() +
geom_rect(aes(xmin=c(0,PCS[-9]), xmax = PCS, ymin = -Inf, ymax = Inf))
c(0,PCS[-9])
PCS
ggplot() +
geom_rect(aes(xmin=c(0,PCS[-9]), xmax = PCS, ymin = -Inf, ymax = Inf, fill=1))
ggplot() +
geom_rect(aes(xmin=c(0,PCS[-9]), xmax = PCS, ymin = -Inf, ymax = Inf, fill="red"))
ggplot() +
geom_rect(aes(xmin=c(0,PCS[-9]), xmax = PCS, ymin = -Inf, ymax = Inf), fill="red")
ggplot() +
geom_line(ruta_strm, aes(distance, ele)) +
geom_rect(aes(xmin=c(0,PCS[-9]), xmax = PCS, ymin = -Inf, ymax = Inf), fill="red")
ggplot() +
geom_line(ruta_strm, aes(distance, ele))
ggplot() +
geom_line(ruta_strm, aes(distance, ele))
ggplot(ruta_strm) +
geom_line(aes(distance, ele)) +
geom_rect(aes(xmin=c(0,PCS[-9]), xmax = PCS, ymin = -Inf, ymax = Inf), fill="red")
ggplot(ruta_strm) +
geom_line(aes(distance, ele)) +
geom_rect(data = 1:9, aes(xmin=c(0,PCS[-9]), xmax = PCS, ymin = -Inf, ymax = Inf), fill="red")
PCSdf <- data.frame("xmin"=c(0,PCS[-9]), "xmax"=PCS, "fill" = brewer.pal(n = 9, name = "Paired"))
View(PCSdf)
ggplot(ruta_strm) +
geom_line(aes(distance, ele)) +
geom_rect(data=PCSdf, aes(xmin=xmin, xmax = xman, ymin = -Inf, ymax = Inf), fill="red")
ggplot(ruta_strm) +
geom_line(aes(distance, ele)) +
geom_rect(data=PCSdf, aes(xmin=xmin, xmax = xmax, ymin = -Inf, ymax = Inf), fill="red")
ggplot() +
geom_line(data =ruta_strm, aes(distance, ele)) +
geom_rect(data=PCSdf, aes(xmin=xmin, xmax = xmax, ymin = -Inf, ymax = Inf), fill="red")
ggplot() +
geom_rect(data=PCSdf, aes(xmin=xmin, xmax = xmax, ymin = -Inf, ymax = Inf), fill="red") +
geom_line(data =ruta_strm, aes(distance, ele))
ggplot() +
geom_rect(data=PCSdf, aes(xmin=xmin, xmax = xmax, ymin = -Inf, ymax = Inf, , fill=fill)) +
geom_line(data =ruta_strm, aes(distance, ele))
ggplot() +
geom_rect(data=PCSdf, aes(xmin=xmin, xmax = xmax, ymin = -Inf, ymax = Inf,fill=fill)) +
geom_line(data =ruta_strm, aes(distance, ele))
ggplot() +
geom_rect(data=PCSdf, aes(xmin=xmin, xmax = xmax, ymin = -Inf, ymax = Inf, fill=fill)) +
geom_line(data =ruta_strm, aes(distance, ele)) +
ylab("Elevación (msnm)") +
xlab("Distancia") +
theme_minimal()
ggplot() +
geom_rect(data=PCSdf, aes(xmin=xmin, xmax = xmax, ymin = -Inf, ymax = Inf, fill=fill), alpha = 0.5) +
geom_line(data =ruta_strm, aes(distance, ele)) +
ylab("Elevación (msnm)") +
xlab("Distancia") +
theme_minimal()
ggplot() +
geom_rect(data=PCSdf, aes(xmin=xmin, xmax = xmax, ymin = -Inf, ymax = Inf, fill=fill), alpha = 0.5) +
geom_line(data =ruta_strm, aes(distance, ele)) +
ylab("Elevación (msnm)") +
xlab("Distancia") +
theme_minimal() +
theme(legend.position = element_blank())
ggplot() +
geom_rect(data=PCSdf, aes(xmin=xmin, xmax = xmax, ymin = -Inf, ymax = Inf, fill=fill), alpha = 0.5) +
geom_line(data =ruta_strm, aes(distance, ele)) +
ylab("Elevación (msnm)") +
xlab("Distancia") +
theme_minimal() +
theme(legend.position = "NULL")
colores <- brewer.pal(n = 9, name = "Paired")
leaflet(width = '100%') %>%
addTiles() %>%  # Add default OpenStreetMap map tiles
addProviderTiles(providers$OpenTopoMap) %>% ## uso mapa topografico
addCircleMarkers(data = tramo1sp, radius = 1, col = colorFactor(colores[1]), group="Tramo 1") %>%
addCircleMarkers(data = tramo2sp, radius = 1, col = colores[2], group="Tramo 2") %>%
addCircleMarkers(data = tramo3sp, radius = 1, col = colores[3], group="Tramo 3") %>%
addCircleMarkers(data = tramo4sp, radius = 1, col = colores[4], group="Tramo 4") %>%
addCircleMarkers(data = tramo5sp, radius = 1, col = colores[5], group="Tramo 5") %>%
addCircleMarkers(data = tramo6sp, radius = 1, col = colores[6], group="Tramo 6") %>%
addCircleMarkers(data = tramo7sp, radius = 1, col = colores[7], group="Tramo 7") %>%
addCircleMarkers(data = tramo8sp, radius = 1, col = colores[8], group="Tramo 8") %>%
addCircleMarkers(data = tramo9sp, radius = 1, col = colores[9], group="Tramo 9") %>%
addCircleMarkers(data = hitossp, radius = 5, col = "red", popup = hitossp$V4) %>%
addLayersControl(
overlayGroups =c("Tramo 1", "Tramo 2", "Tramo 3", "Tramo 4", "Tramo 5", "Tramo 6", "Tramo 7", "Tramo 8", "Tramo 9"),
options = layersControlOptions(collapsed=TRUE)
)
ggplot() +
geom_rect(data=PCSdf, aes(xmin=xmin, xmax = xmax, ymin = -Inf, ymax = Inf, fill=fill), alpha = 0.5) +
geom_line(data =ruta_strm, aes(distance, ele)) +
ylab("Elevación (msnm)") +
xlab("Distancia") +
theme_minimal() +
theme(legend.position = "NULL")
ggplot() +
geom_rect(data=PCSdf, aes(xmin=xmin, xmax = xmax, ymin = -Inf, ymax = Inf),fill=fill, alpha = 0.5) +
geom_line(data =ruta_strm, aes(distance, ele)) +
ylab("Elevación (msnm)") +
xlab("Distancia") +
theme_minimal() +
theme(legend.position = "NULL")
ggplot() +
geom_rect(data=PCSdf, aes(xmin=xmin, xmax = xmax, ymin = -Inf, ymax = Inf), fill=fill, alpha = 0.5) +
geom_line(data =ruta_strm, aes(distance, ele)) +
ylab("Elevación (msnm)") +
xlab("Distancia") +
theme_minimal() +
theme(legend.position = "NULL")
ggplot() +
geom_rect(data=PCSdf, aes(xmin=xmin, xmax = xmax, ymin = -Inf, ymax = Inf), alpha = 0.5) +
geom_line(data =ruta_strm, aes(distance, ele)) +
ylab("Elevación (msnm)") +
xlab("Distancia") +
theme_minimal() +
theme(legend.position = "NULL")
ggplot() +
geom_rect(data=PCSdf, aes(xmin=xmin, xmax = xmax, ymin = -Inf, ymax = Inf, fill=fill),col=colores, alpha = 0.5) +
geom_line(data =ruta_strm, aes(distance, ele)) +
ylab("Elevación (msnm)") +
xlab("Distancia") +
theme_minimal() +
theme(legend.position = "NULL")
ggplot() +
geom_rect(data=PCSdf, aes(xmin=xmin, xmax = xmax, ymin = -Inf, ymax = Inf, fill=fill),fill=colores, alpha = 0.5) +
geom_line(data =ruta_strm, aes(distance, ele)) +
ylab("Elevación (msnm)") +
xlab("Distancia") +
theme_minimal() +
theme(legend.position = "NULL")
ggplot() +
geom_rect(data=PCSdf, aes(xmin=xmin, xmax = xmax, ymin = -Inf, ymax = Inf),fill=colores, alpha = 0.5) +
geom_line(data =ruta_strm, aes(distance, ele)) +
ylab("Elevación (msnm)") +
xlab("Distancia") +
theme_minimal() +
theme(legend.position = "NULL")
leaflet(width = '100%') %>%
addTiles() %>%  # Add default OpenStreetMap map tiles
addProviderTiles(providers$OpenTopoMap) %>% ## uso mapa topografico
addCircleMarkers(data = tramo1sp, radius = 1, col = colores[1], group="Tramo 1") %>%
addCircleMarkers(data = tramo2sp, radius = 1, col = colores[2], group="Tramo 2") %>%
addCircleMarkers(data = tramo3sp, radius = 1, col = colores[3], group="Tramo 3") %>%
addCircleMarkers(data = tramo4sp, radius = 1, col = colores[4], group="Tramo 4") %>%
addCircleMarkers(data = tramo5sp, radius = 1, col = colores[5], group="Tramo 5") %>%
addCircleMarkers(data = tramo6sp, radius = 1, col = colores[6], group="Tramo 6") %>%
addCircleMarkers(data = tramo7sp, radius = 1, col = colores[7], group="Tramo 7") %>%
addCircleMarkers(data = tramo8sp, radius = 1, col = colores[8], group="Tramo 8") %>%
addCircleMarkers(data = tramo9sp, radius = 1, col = colores[9], group="Tramo 9") %>%
addCircleMarkers(data = hitossp, radius = 5, col = "red", popup = hitossp$V4) %>%
addLayersControl(
overlayGroups =c("Tramo 1", "Tramo 2", "Tramo 3", "Tramo 4", "Tramo 5", "Tramo 6", "Tramo 7", "Tramo 8", "Tramo 9"),
options = layersControlOptions(collapsed=TRUE)
)
ggplot() +
geom_rect(data=PCSdf, aes(xmin=xmin, xmax = xmax, ymin = -Inf, ymax = Inf),fill=colores, alpha = 0.8) +
geom_line(data =ruta_strm, aes(distance, ele)) +
ylab("Elevación (msnm)") +
xlab("Distancia") +
theme_minimal() +
theme(legend.position = "NULL")
```{r, echo=FALSE, fig.asp = .62}}
```{r, echo=FALSE,fig.width = 5, fig.asp = .62}}
PCSdf <- data.frame("xmin"=c(0,PCS[-9]), "xmax"=PCS, "fill" = colores)
ggplot() +
geom_rect(data=PCSdf, aes(xmin=xmin, xmax = xmax, ymin = -Inf, ymax = Inf),fill=colores, alpha = 0.8) +
geom_line(data =ruta_strm, aes(distance, ele)) +
ylab("Elevación (msnm)") +
xlab("Distancia") +
theme_minimal() +
theme(legend.position = "NULL")
```{r, fig.width = 5, fig.asp = .62,  echo=FALSE,}
```{r, fig.width = 5, fig.asp = .62,  echo=FALSE}
PCSdf <- data.frame("xmin"=c(0,PCS[-9]), "xmax"=PCS, "fill" = colores)
library(GPStream)
library(sp)
library(sp)
library(leaflet)
library(RColorBrewer)
ruta_strm <-
read_stream_file("cajon_del_mapocho.gpx") %>%
rename_stream() %>%
differential_stream()
ruta_strm <-
read_stream("cajon_del_mapocho.gpx") %>%
rename_stream() %>%
differential_stream()
remotes::install_github("raimun2/GPStream")
detach("package:GPStream", unload = TRUE)
remotes::install_github("raimun2/GPStream")
library(GPStream)
#' Load GPS streams from a single gpx or fit file and stores it in a Tibble
#' Allows to process files from Strava's bulk export, which includes compressed fit files (*.fit.gz)
#' @param filename The file path to the directory containing file
#' read_stream_file()
#'
#' @return
#' @export
#'
read_stream_file <- function(filename){
# if file ends in "*fit.gz", then unzip it, maintaining the original file
if(length(grep(".fit.gz",filename))>0)
{
R.utils::gunzip(filename,remove=FALSE, overwrite=TRUE)
filename <- gsub(".gz$","",filename) # remove ".gz" from filename
}
# if fit file (including uncompressed file) use FITfileR library
if(length(grep(".fit$",filename))>0){
file_data <- FITfileR::readFitFile(filename)
stream_df <- FITfileR::records(file_data)
stream_df$timestamp <- lubridate::as_datetime(stream_df$timestamp) #parse datetime
} else if(grep(".gpx$",filename)==1) { # if gpx file use plotKML library
file_data <- plotKML::readGPX(filename)
stream_df <- tibble::as_tibble(file_data$tracks[[1]][[1]])
stream_df$ele <- as.numeric(stream_df$ele) #parse elevation as numeric
stream_df$time <- lubridate::as_datetime(stream_df$time) #parse datetime
} else{
message("unsupported format")
}
return(stream_df) #return tibble with file stream
}
#' Title
#'
#' @param data dataframe or tibble containing a GPS stream
#'
#' @return
#' @export
#'
differential_stream <- function(data){
# previous lon / lat
data$point2_lat = c(0,data$lat[-nrow(data)])
data$point2_lon = c(0,data$lon[-nrow(data)])
# haversise distance between each point and previous one
data$delta_distance = geosphere::distHaversine(cbind(data$lon,data$lat),
cbind(data$point2_lon,data$point2_lat))
data$delta_distance[1] = 0
## 3d distance tambien
# calculate cumulative distance in kms
data$distance <- cumsum(data$delta_distance) / 1000
data$delta_ele <- c(0,diff(data$ele,lag=1))
data$delta_ele[1] <- 0
data$dplus <- ifelse(data$delta_ele>0, data$delta_ele, 0)
data$dminus <- ifelse(data$delta_ele<0, data$delta_ele, 0)
# 2 point previous
data$point3_lat = c(0,data$point2_lat[-nrow(data)])
data$point3_lon = c(0,data$point2_lon[-nrow(data)])
vector1 <- cbind(data$lon-data$point2_lon, data$lat-data$point2_lat)
vector2 <- cbind(data$point3_lon-data$point2_lon,data$point3_lat-data$point2_lat)
num <- vector1[,1]*vector2[,1] + vector1[,2]*vector2[,2]
den <- sqrt(vector1[,1]^2 + vector1[,2]^2)*sqrt(vector2[,1]^2 + vector2[,2]^2)
data$angle <- ifelse(den == 0, 180, (360*acos(num/den))/(2*pi) )
data$point2_lat = NULL
data$point2_lon = NULL
data$point3_lat = NULL
data$point3_lon = NULL
data$grade = ( data$delta_ele / data$delta_distance )
data$grade[1] = 0
data[data$delta_distance == 0,]$grade = 0
if(!is.null(data$time)){
# calculate difference in time and elevation between readings
data$delta_time = c(0,diff(data$time,lag=1))
data$delta_time[1] = 0
# calculate derivatives: vertical and horizontal velocity, in meters per second
data$vert_velocity = data$delta_ele / data$delta_time
data$vert_velocity[1] = 0
data$hz_velocity = data$delta_distance / data$delta_time
data$hz_velocity[1] = 0
#3d velocity
data$velocity <- sqrt(data$vert_velocity^2 + data$hz_velocity^2)
# calculate pace in minutes per kilometer
data$pace <- c(0,1000/60/data$hz_velocity[-1])
}
# return enriched dataset
return(data)
}
install.packages("gdalUtils")
library(sp)
p = Polygon(coords = matrix(c(1,2,2,1,1,1,1,2,2,1), ncol = 2))
p1= Polygons(list(p), ID=1)
p2=SpatialPolygons(list(p1))
p3=SpatialPolygonsDataFrame(p2, data = as.data.frame("1"))
library(rgdal)
library(gdalUtils)
writeOGR(p3, dsn = "square1", layer = "entities", driver="GMT")  #layer MUST be entities and final GMT is then called entities
writeOGR(p3, dsn = "square1", layer = "entities", driver="DXF")  #layer MUST be entities and final GMT is then called entities
library(RPostgreSQL)
writeOGR(p3, dsn = "square1", layer = "entities", driver="GMT")  #layer MUST be entities and final GMT is then called entities
